C51 COMPILER V6.02  BLINKING_LIGHTS                                                        12/01/2019 15:27:40 PAGE 1   


C51 COMPILER V6.02, COMPILATION OF MODULE BLINKING_LIGHTS
OBJECT MODULE PLACED IN .\Blinking_Lights.OBJ
COMPILER INVOKED BY: C:\Keil\C51\BIN\C51.EXE .\Blinking_Lights.c DEBUG OBJECTEXTEND

stmt level    source

   1          #include "Blinking_Lights.h"
   2          #include "PORT.h"
   3          
   4          // Function to set lights based on input numbers
   5          void set_lights(bit green, bit amber, bit yellow, bit red) {
   6   1          GREENLED = green;
   7   1          AMBERLED = amber;
   8   1          YELLOWLED = yellow;
   9   1          REDLED = red;
  10   1      }
  11          
  12          // Function to control traffic light system state
  13          void blinking_lights_isr(void) interrupt TIMER_2_OVERFLOW {
  14   1          TF2 = 0; // clear interrupt flag
  15   1          TIMER++; // increment timer
  16   1      
  17   1      	// Debounce this crap
  18   1      	if(SW1)
  19   1      	{
  20   2      		Button_1 = ~Button_1;
  21   2      	}
  22   1      	else if(SW4)
  23   1      	{
  24   2      		Button_4 = ~Button_4;
  25   2      	}
  26   1      	switch(SYSTEM_STATE)
  27   1      	{
  28   2      		// TODO: need to worry about going backwards through states in if..else statements
  29   2      		case IDLE_STATE:
  30   2      			set_lights(0,0,0,0);
  31   2      			if(Button_1&&TIMER==1000)
  32   2      			{
  33   3      				SYSTEM_STATE = STATE_1;
  34   3      				TIMER = 0;
  35   3      			}
  36   2      			else if(Button_4&&TIMER==1000)
  37   2      			{
  38   3      				SYSTEM_STATE = STATE_7;
  39   3      				TIMER = 0;
  40   3      			}
  41   2      			else
  42   2      			{
  43   3      				SYSTEM_STATE = IDLE_STATE;
  44   3      				TIMER = 0;
  45   3      			}
  46   2      			break;
  47   2      		case STATE_1:
  48   2      			set_lights(1,0,0,0);
  49   2      			if(Button_1&&TIMER==1000)
  50   2      			{
  51   3      				SYSTEM_STATE = STATE_2;
  52   3      				TIMER = 0;
  53   3      			}
  54   2      			else if(Button_4&&TIMER==1000)
  55   2      			{
C51 COMPILER V6.02  BLINKING_LIGHTS                                                        12/01/2019 15:27:40 PAGE 2   

  56   3      				SYSTEM_STATE = IDLE_STATE;
  57   3      				TIMER = 0;
  58   3      			}
  59   2      			else
  60   2      			{
  61   3      				SYSTEM_STATE = IDLE_STATE;
  62   3      				TIMER = 0;
  63   3      			}
  64   2      			break;
  65   2      		case STATE_2:
  66   2      			set_lights(1,1,0,0);
  67   2      			if(Button_1&&TIMER==1000)
  68   2      			{
  69   3      				SYSTEM_STATE = STATE_3;
  70   3      				TIMER = 0;
  71   3      			}
  72   2      			else if(Button_4&&TIMER==1000)
  73   2      			{
  74   3      				SYSTEM_STATE = STATE_1;
  75   3      				TIMER = 0;
  76   3      			}
  77   2      			else
  78   2      			{
  79   3      				SYSTEM_STATE = IDLE_STATE;
  80   3      				TIMER = 0;
  81   3      			}
  82   2      			break;
  83   2      		case STATE_3:
  84   2      			set_lights(1,1,1,0);
  85   2      			if(Button_1&&TIMER==1000)
  86   2      			{
  87   3      				SYSTEM_STATE = STATE_4;
  88   3      				TIMER = 0;
  89   3      			}
  90   2      			else if(Button_4&&TIMER==1000)
  91   2      			{
  92   3      				SYSTEM_STATE = STATE_2;
  93   3      				TIMER = 0;
  94   3      			}
  95   2      			else
  96   2      			{
  97   3      				SYSTEM_STATE = IDLE_STATE;
  98   3      				TIMER = 0;
  99   3      			}
 100   2      			break;
 101   2      		case STATE_4:
 102   2      			set_lights(1,1,1,1);
 103   2      			if(Button_1&&TIMER==1000)
 104   2      			{
 105   3      				SYSTEM_STATE = STATE_5;
 106   3      				TIMER = 0;
 107   3      			}
 108   2      			else if(Button_4&&TIMER==1000)
 109   2      			{
 110   3      				SYSTEM_STATE = STATE_3;
 111   3      				TIMER = 0;
 112   3      			}
 113   2      			else
 114   2      			{
 115   3      				SYSTEM_STATE = IDLE_STATE;
 116   3      				TIMER = 0;
 117   3      			}
C51 COMPILER V6.02  BLINKING_LIGHTS                                                        12/01/2019 15:27:40 PAGE 3   

 118   2      			break;
 119   2      		case STATE_5:
 120   2      			set_lights(0,1,1,1);
 121   2      			if(Button_1&&TIMER==1000)
 122   2      			{
 123   3      				SYSTEM_STATE = STATE_5;
 124   3      				TIMER = 0;
 125   3      			}
 126   2      			else if(Button_4&&TIMER==1000)
 127   2      			{
 128   3      			 	SYSTEM_STATE = STATE_4;
 129   3      				TIMER = 0;
 130   3      			}
 131   2      			else
 132   2      			{
 133   3      				SYSTEM_STATE = IDLE_STATE;
 134   3      				TIMER = 0;
 135   3      			}
 136   2      			break;
 137   2      		case STATE_6:
 138   2      			set_lights(0,0,1,1);
 139   2      			if(Button_1&&TIMER==1000)
 140   2      			{
 141   3      				SYSTEM_STATE = STATE_7;
 142   3      				TIMER = 0;
 143   3      			}
 144   2      			else if(Button_4&&TIMER==1000)
 145   2      			{
 146   3      				SYSTEM_STATE = STATE_5;
 147   3      				TIMER = 0;
 148   3      			}
 149   2      			else
 150   2      			{
 151   3      				SYSTEM_STATE = IDLE_STATE;
 152   3      				TIMER = 0;
 153   3      			}
 154   2      			break;
 155   2      		case STATE_7:
 156   2      			set_lights(0,0,0,1);
 157   2      			if(Button_1&&TIMER==1000)
 158   2      			{
 159   3      				SYSTEM_STATE = IDLE_STATE;
 160   3      				TIMER = 0;
 161   3      			}
 162   2      			else if(Button_4&&TIMER==1000)
 163   2      			{
 164   3      				SYSTEM_STATE = STATE_6;
 165   3      				TIMER = 0;
 166   3      			}
 167   2      			else
 168   2      			{
 169   3      				SYSTEM_STATE = IDLE_STATE;
 170   3      				TIMER = 0;
 171   3      			}
 172   2      			break;
 173   2      	}
 174   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    970    ----
   CONSTANT SIZE    =   ----    ----
C51 COMPILER V6.02  BLINKING_LIGHTS                                                        12/01/2019 15:27:40 PAGE 4   

   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      5    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =      2       4
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
